<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stock Landing â€” Autocomplete Demo</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; margin: 20px; background:#f7f9fc; color:#111; }
    .container { max-width:800px; margin:0 auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 6px 18px rgba(12,20,40,0.06); }
    h1 { margin:0 0 12px; font-size:20px; }
    .field { position:relative; margin-top:14px; }
    #stock-input { width:100%; padding:12px 14px; border:1px solid #ddd; border-radius:6px; font-size:15px; }
    #stock-dropdown { display:none; position:absolute; left:0; right:0; top:100%; z-index:9999; background:#fff; border:1px solid #e3e8ef; border-top:0; max-height:260px; overflow:auto; }
    .stock-item { padding:10px 12px; cursor:pointer; display:flex; justify-content:space-between; gap:12px; align-items:center; }
    .stock-item:hover, .stock-item.highlight { background:#eef7ff; }
    .stock-code { font-weight:700; font-size:13px; color:#0b2a6b; }
    .stock-name { font-size:13px; color:#333; opacity:0.85; }
    .row { display:flex; gap:10px; margin-top:14px; }
    #check-now-btn { padding:10px 16px; border-radius:6px; border:0; background:#0066ff; color:#fff; cursor:pointer; }
    .countdown { display:flex; gap:12px; margin-top:16px; }
    .cd-box { background:#f0f6ff; padding:8px 12px; border-radius:6px; text-align:center; min-width:64px; }
    .cd-num { font-weight:700; font-size:16px; }
    .muted { color:#666; font-size:13px; margin-top:8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Search Stocks (Ready-to-use Landing)</h1>

    <div class="field">
      <input id="stock-input" placeholder="Search by code or company name (e.g. RELIANCE or Tata)" autocomplete="off" />
      <div id="stock-dropdown" role="listbox" aria-label="Stock suggestions"></div>
    </div>

    <div class="row">
      <button id="check-now-btn">Join Telegram Channel</button>
      <div class="muted">Click button to open Telegram (replace link in script).</div>
    </div>

    <div class="countdown" aria-hidden="true">
      <div class="cd-box"><div id="days" class="cd-num">00</div><div>Days</div></div>
      <div class="cd-box"><div id="hours" class="cd-num">00</div><div>Hours</div></div>
      <div class="cd-box"><div id="minutes" class="cd-num">00</div><div>Minutes</div></div>
      <div class="cd-box"><div id="seconds" class="cd-num">00</div><div>Seconds</div></div>
    </div>
  </div>

  <!-- If you prefer inline JS array instead of fetch, include merged_topStocks.js HERE -->
  <!-- <script src="merged_topStocks.js"></script> -->

  <script>
  (function(){
    // CONFIG
    const JSON_FILE = 'merged_stocks.json'; // use merged_topStocks.js if you included the JS file above
    const TELEGRAM_URL = 'https://t.me/YOUR_CHANNEL_OR_INVITE'; // <-- replace

    // DOM
    const stockInput = document.getElementById('stock-input');
    const stockDropdown = document.getElementById('stock-dropdown');
    const checkNowBtn = document.getElementById('check-now-btn');
    const daysEl = document.getElementById('days');
    const hoursEl = document.getElementById('hours');
    const minutesEl = document.getElementById('minutes');
    const secondsEl = document.getElementById('seconds');

    // state
    let topStocks = [];
    let highlightedIndex = -1;
    const MAX_RESULTS = 12;

    // Safe HTML escape
    function escapeHtml(str='') {
      return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;');
    }
    function norm(s=''){ return String(s).toUpperCase().normalize('NFKD').replace(/[\u0300-\u036f]/g,''); }

    // Load stocks: try fetch JSON; fallback to window.topStocks if present
    async function loadStocks() {
      // If merged_topStocks.js loaded, it will define window.topStocks
      if (window.topStocks && Array.isArray(window.topStocks) && window.topStocks.length) {
        topStocks = window.topStocks;
        return;
      }
      try {
        const r = await fetch(JSON_FILE, {cache:'no-cache'});
        if (!r.ok) throw new Error('Fetch failed');
        const arr = await r.json();
        if (Array.isArray(arr)) topStocks = arr;
      } catch (err) {
        console.warn('Could not load JSON; window.topStocks used if present.', err);
        topStocks = window.topStocks || [];
      }
    }

    // Render dropdown
    function renderDropdown(results) {
      stockDropdown.innerHTML = '';
      highlightedIndex = -1;
      if (!results.length) { stockDropdown.style.display='none'; return; }
      results.forEach((s, idx) => {
        const div = document.createElement('div');
        div.className = 'stock-item';
        div.tabIndex = -1;
        div.innerHTML = '<span class="stock-code">' + escapeHtml(s.code) + '</span>' +
                        '<span class="stock-name">' + escapeHtml(s.name) + '</span>';
        div.addEventListener('click', () => {
          selectStock(s);
        });
        stockDropdown.appendChild(div);
      });
      stockDropdown.style.display = 'block';
    }

    function selectStock(s) {
      stockInput.value = s.name;
      stockDropdown.style.display = 'none';
      stockInput.focus();
      // Custom event if needed:
      stockInput.dispatchEvent(new CustomEvent('stock-selected',{detail:s}));
    }

    function search(q) {
      q = norm(q.trim());
      if (!q) { stockDropdown.style.display='none'; return; }
      const out = [];
      for (let i=0;i<topStocks.length && out.length<MAX_RESULTS;i++){
        const st = topStocks[i];
        if (!st) continue;
        if (norm(st.code).includes(q) || norm(st.name).includes(q)) out.push(st);
      }
      renderDropdown(out);
    }

    const debounced = (fn, wait=180) => {
      let t;
      return (...a) => { clearTimeout(t); t = setTimeout(()=>fn(...a), wait); };
    };

    // keyboard nav
    stockInput.addEventListener('keydown', (e)=>{
      const items = stockDropdown.querySelectorAll('.stock-item');
      if (stockDropdown.style.display==='none' || !items.length) return;
      if (e.key==='ArrowDown'){ e.preventDefault(); highlightedIndex = Math.min(highlightedIndex+1, items.length-1); updateHighlight(items); }
      else if (e.key==='ArrowUp'){ e.preventDefault(); highlightedIndex = Math.max(highlightedIndex-1, 0); updateHighlight(items); }
      else if (e.key==='Enter'){ e.preventDefault(); if (highlightedIndex>=0) items[highlightedIndex].click(); }
      else if (e.key==='Escape'){ stockDropdown.style.display='none'; }
    });

    function updateHighlight(items){
      items.forEach((it, idx)=> it.classList.toggle('highlight', idx===highlightedIndex));
      if (highlightedIndex>=0 && items[highlightedIndex]) items[highlightedIndex].scrollIntoView({block:'nearest'});
    }

    // input
    stockInput.addEventListener('input', debounced((e)=> search(e.target.value), 180));

    document.addEventListener('click', (e)=>{
      if (!stockInput.contains(e.target) && !stockDropdown.contains(e.target)) stockDropdown.style.display='none';
    });

    // Telegram button
    checkNowBtn.addEventListener('click', ()=> window.open(TELEGRAM_URL, '_blank','noopener'));

    // Countdown: sample 9h19m35s from now
    const target = new Date();
    target.setHours(target.getHours()+9);
    target.setMinutes(target.getMinutes()+19);
    target.setSeconds(target.getSeconds()+35);

    function updateCountdown(){
      const now = Date.now(), diff = target.getTime() - now;
      if (diff<=0){ daysEl.textContent='00'; hoursEl.textContent='00'; minutesEl.textContent='00'; secondsEl.textContent='00'; return; }
      const days = Math.floor(diff/(1000*60*60*24));
      const hours = Math.floor((diff/(1000*60*60))%24);
      const minutes = Math.floor((diff/(1000*60))%60);
      const seconds = Math.floor((diff/1000)%60);
      daysEl.textContent = String(days).padStart(2,'0');
      hoursEl.textContent = String(hours).padStart(2,'0');
      minutesEl.textContent = String(minutes).padStart(2,'0');
      secondsEl.textContent = String(seconds).padStart(2,'0');
    }
    updateCountdown();
    setInterval(updateCountdown, 1000);

    // Init
    (async function init(){
      await loadStocks();
      // If topStocks empty, add a tiny fallback sample
      if (!topStocks.length) topStocks = [{code:'RELIANCE', name:'Reliance Industries Ltd'}, {code:'TCS', name:'Tata Consultancy Services Ltd'}];
    })();

  })();
  </script>
</body>
</html>
